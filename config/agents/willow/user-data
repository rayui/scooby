#cloud-config
# vim: syntax=yaml
#

# Set your hostname here, the manage_etc_hosts will update the hosts file entries as well
hostname: willow 
manage_etc_hosts: true

package_update: true 
package_upgrade: true
package_reboot_if_required: true

# Add an authorized ssh key to ray and lock password
users:
  - name: ray
    sudo: ALL=(ALL) NOPASSWD:ALL
    lock_passwd: true 
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKHKUWRvC+/vT8b48zgngQMO046vXfgeNpQR/lQ6QMEj ray.userinterface@gmail.com

write-files:
  - path: /boot/cmdline.txt
    owner: 'root:root'
    mode: 0600
    content: |
      dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/nfs nfsroot=192.168.64.1:/nfs/willow,udp,nfsvers=3,rsize=32768,wsize=32768,hard,intr rw ip=dhcp rootwait elevator=deadline cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory

runcmd:
  - cd /tmp && curl -sLS https://get.k3sup.dev | sh
  - k3sup join --ip 192.168.64.64 --server-ip 192.168.64.1 --ssh-key "/home/ray/.ssh/id_ed25519"
